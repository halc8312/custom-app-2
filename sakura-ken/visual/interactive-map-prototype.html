<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡œçœŒã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ— - ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f5f5f5;
        }
        
        #header {
            background-color: #FFB6C1;
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        #header h1 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        #container {
            display: flex;
            height: calc(100vh - 120px);
        }
        
        #sidebar {
            width: 300px;
            background-color: white;
            padding: 1rem;
            overflow-y: auto;
            box-shadow: 2px 0 4px rgba(0,0,0,0.1);
        }
        
        #map {
            flex: 1;
            height: 100%;
        }
        
        #info-panel {
            width: 350px;
            background-color: white;
            padding: 1rem;
            overflow-y: auto;
            box-shadow: -2px 0 4px rgba(0,0,0,0.1);
            display: none;
        }
        
        #info-panel.active {
            display: block;
        }
        
        .search-container {
            margin-bottom: 1.5rem;
        }
        
        #search-input {
            width: 100%;
            padding: 0.75rem;
            font-size: 0.875rem;
            border: 2px solid #FFB6C1;
            border-radius: 4px;
            outline: none;
        }
        
        #search-input:focus {
            border-color: #C71585;
        }
        
        .search-results {
            margin-top: 0.5rem;
            background-color: #f9f9f9;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .search-result-item {
            padding: 0.75rem;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        
        .search-result-item:hover {
            background-color: #FFB6C1;
            color: white;
        }
        
        .layer-control {
            margin-bottom: 1.5rem;
        }
        
        .layer-control h3 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .layer-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .layer-checkbox input {
            margin-right: 0.5rem;
        }
        
        .city-info {
            background-color: #f9f9f9;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .city-info h2 {
            color: #C71585;
            margin-bottom: 0.5rem;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .info-label {
            font-weight: bold;
            color: #666;
        }
        
        .info-value {
            color: #333;
        }
        
        .chart-container {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f5f5f5;
            border-radius: 8px;
        }
        
        #footer {
            background-color: #333;
            color: white;
            padding: 1rem;
            text-align: center;
            font-size: 0.875rem;
        }
        
        .leaflet-popup-content {
            font-size: 0.875rem;
        }
        
        .legend {
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .legend h4 {
            margin-bottom: 5px;
            font-size: 0.875rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 5px;
            border: 1px solid #ccc;
        }
        
        .close-button {
            float: right;
            cursor: pointer;
            font-size: 1.2rem;
            color: #999;
        }
        
        .close-button:hover {
            color: #333;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>ğŸŒ¸ æ¡œçœŒã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ—</h1>
        <p>å„å¸‚ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º</p>
    </div>
    
    <div id="container">
        <div id="sidebar">
            <div class="search-container">
                <h3>å¸‚ã‚’æ¤œç´¢</h3>
                <input type="text" id="search-input" placeholder="å¸‚åã‚’å…¥åŠ›...">
                <div class="search-results" id="search-results"></div>
            </div>
            
            <div class="layer-control">
                <h3>è¡¨ç¤ºãƒ¬ã‚¤ãƒ¤ãƒ¼</h3>
                <div class="layer-checkbox">
                    <input type="checkbox" id="cities-layer" checked>
                    <label for="cities-layer">å¸‚å¢ƒç•Œ</label>
                </div>
                <div class="layer-checkbox">
                    <input type="checkbox" id="labels-layer" checked>
                    <label for="labels-layer">åœ°åãƒ©ãƒ™ãƒ«</label>
                </div>
                <div class="layer-checkbox">
                    <input type="checkbox" id="population-layer">
                    <label for="population-layer">äººå£å¯†åº¦</label>
                </div>
                <div class="layer-checkbox">
                    <input type="checkbox" id="tourism-layer">
                    <label for="tourism-layer">è¦³å…‰ã‚¹ãƒãƒƒãƒˆ</label>
                </div>
                <div class="layer-checkbox">
                    <input type="checkbox" id="transport-layer">
                    <label for="transport-layer">äº¤é€šã‚¤ãƒ³ãƒ•ãƒ©</label>
                </div>
            </div>
            
            <div class="layer-control">
                <h3>ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º</h3>
                <select id="data-type" style="width: 100%; padding: 0.5rem;">
                    <option value="none">ãªã—</option>
                    <option value="population">äººå£</option>
                    <option value="density">äººå£å¯†åº¦</option>
                    <option value="area">é¢ç©</option>
                    <option value="gdp">çµŒæ¸ˆè¦æ¨¡</option>
                </select>
            </div>
            
            <div class="layer-control">
                <h3>çµ±è¨ˆæƒ…å ±</h3>
                <div class="info-item">
                    <span class="info-label">ç·äººå£</span>
                    <span class="info-value">285ä¸‡4,327äºº</span>
                </div>
                <div class="info-item">
                    <span class="info-label">ç·é¢ç©</span>
                    <span class="info-value">2,456.78 kmÂ²</span>
                </div>
                <div class="info-item">
                    <span class="info-label">å¸‚ã®æ•°</span>
                    <span class="info-value">6å¸‚</span>
                </div>
            </div>
        </div>
        
        <div id="map"></div>
        
        <div id="info-panel">
            <h2>è©³ç´°æƒ…å ± <span class="close-button" onclick="closeInfoPanel()">Ã—</span></h2>
            <div id="city-details">
                <p>å¸‚ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’è¡¨ç¤º</p>
            </div>
        </div>
    </div>
    
    <div id="footer">
        <p>Â© 2025 æ¡œçœŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ | ãƒ‡ãƒ¼ã‚¿æœ€çµ‚æ›´æ–°: 2025å¹´7æœˆ11æ—¥</p>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // åœ°å›³ã®åˆæœŸåŒ–
        const map = L.map('map').setView([35.45, 139.55], 10);
        let citiesLayer;
        let labelsLayer;
        let tourismLayer;
        let transportLayer;
        let currentDataType = 'none';
        
        // ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒ—
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);
        
        // å¸‚ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Œå…¨ç‰ˆï¼‰
        const cityData = {
            "æ¡œèŠ±å¸‚": {
                population: 890234,
                density: 1948.3,
                area: 456.78,
                type: "çœŒåºæ‰€åœ¨åœ°",
                industries: ["é‡‘èãƒ»ä¿é™ºæ¥­", "æƒ…å ±é€šä¿¡æ¥­", "å•†æ¥­ãƒ»ã‚µãƒ¼ãƒ“ã‚¹æ¥­"],
                mayor: "ç”°ä¸­ä¸€éƒ",
                specialties: ["æ¡œèŠ±ã¾ã‚“ã˜ã‚…ã†", "çœŒåºã‚«ãƒ¬ãƒ¼", "é‡‘èè¡—ãƒ©ãƒ¼ãƒ¡ãƒ³"],
                attractions: ["æ¡œèŠ±åŸ", "çœŒç«‹ç¾è¡“é¤¨", "ä¸­å¤®å…¬åœ’"],
                sister_cities: ["ãƒ‘ãƒªï¼ˆãƒ•ãƒ©ãƒ³ã‚¹ï¼‰", "ã‚µãƒ³ãƒ•ãƒ©ãƒ³ã‚·ã‚¹ã‚³ï¼ˆã‚¢ãƒ¡ãƒªã‚«ï¼‰", "é‡œå±±ï¼ˆéŸ“å›½ï¼‰"]
            },
            "æ¡œå·å¸‚": {
                population: 523456,
                density: 1344.2,
                area: 389.45,
                type: "æ¸¯æ¹¾éƒ½å¸‚",
                industries: ["æ¸¯æ¹¾ç‰©æµæ¥­", "æ°´ç”£æ¥­", "é€ èˆ¹æ¥­"],
                mayor: "æµ·é‡æ´‹å­",
                specialties: ["æ¡œå·å¯¿å¸", "æ¸¯ç”ºç„¼ããã°", "æ¼å¸«ã‚ã—"],
                attractions: ["æ¡œå·æ¸¯", "æµ·æ´‹åšç‰©é¤¨", "é­šå¸‚å ´"],
                sister_cities: ["ãƒãƒ³ãƒ–ãƒ«ã‚¯ï¼ˆãƒ‰ã‚¤ãƒ„ï¼‰", "é‡œå±±ï¼ˆéŸ“å›½ï¼‰", "ã‚·ã‚¢ãƒˆãƒ«ï¼ˆã‚¢ãƒ¡ãƒªã‚«ï¼‰"]
            },
            "æ±æ¡œå¸‚": {
                population: 412345,
                density: 1319.2,
                area: 312.67,
                type: "ãƒã‚¤ãƒ†ã‚¯å·¥æ¥­éƒ½å¸‚",
                industries: ["é›»å­æ©Ÿå™¨è£½é€ æ¥­", "æƒ…å ±é€šä¿¡æ¥­", "ç ”ç©¶é–‹ç™º"],
                mayor: "æŠ€è¡“å¤ªéƒ",
                specialties: ["ãƒ­ãƒœãƒƒãƒˆé¥…é ­", "ã‚µã‚¤ã‚¨ãƒ³ã‚¹ãƒãƒ¼ã‚¬ãƒ¼", "ãƒ†ãƒƒã‚¯ãã°"],
                attractions: ["ãƒ†ã‚¯ãƒãƒ‘ãƒ¼ã‚¯", "ç§‘å­¦åšç‰©é¤¨", "ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚»ãƒ³ã‚¿ãƒ¼"],
                sister_cities: ["ã‚·ãƒªã‚³ãƒ³ãƒãƒ¬ãƒ¼ï¼ˆã‚¢ãƒ¡ãƒªã‚«ï¼‰", "æ·±åœ³ï¼ˆä¸­å›½ï¼‰", "ãƒãƒ³ã‚¬ãƒ­ãƒ¼ãƒ«ï¼ˆã‚¤ãƒ³ãƒ‰ï¼‰"]
            },
            "è¥¿æ¡œå¸‚": {
                population: 198765,
                density: 847.8,
                area: 234.56,
                type: "æ­´å²æ–‡åŒ–éƒ½å¸‚",
                industries: ["ä¼çµ±å·¥èŠ¸", "è¦³å…‰æ¥­", "æ–‡åŒ–ç”£æ¥­"],
                mayor: "æ–‡åŒ–èŠ±å­",
                specialties: ["è¥¿æ¡œç¹”", "æ­´å²è¡—é“ã›ã‚“ã¹ã„", "æ­¦å®¶å±‹æ•·ãã°"],
                attractions: ["è¥¿æ¡œåŸè·¡", "æ­¦å®¶å±‹æ•·ç¾¤", "ä¼çµ±å·¥èŠ¸é¤¨"],
                sister_cities: ["äº¬éƒ½ï¼ˆæ—¥æœ¬ï¼‰", "ãƒ•ã‚£ãƒ¬ãƒ³ãƒ„ã‚§ï¼ˆã‚¤ã‚¿ãƒªã‚¢ï¼‰", "ãƒ—ãƒ©ãƒï¼ˆãƒã‚§ã‚³ï¼‰"]
            },
            "å—æ¡œå¸‚": {
                population: 287654,
                density: 506.5,
                area: 567.89,
                type: "æ¸©æ³‰è¦³å…‰éƒ½å¸‚",
                industries: ["è¦³å…‰æ¥­", "æ—…é¤¨ãƒ»ãƒ›ãƒ†ãƒ«æ¥­", "è¾²æ¥­"],
                mayor: "æ¸©æ³‰æ¬¡éƒ",
                specialties: ["æ¸©æ³‰ã¾ã‚“ã˜ã‚…ã†", "åœ°ç„è’¸ã—æ–™ç†", "æ¹¯ã®èŠ±ã›ã‚“ã¹ã„"],
                attractions: ["å—æ¡œæ¸©æ³‰éƒ·", "åœ°ç„è°·", "æ¸©æ³‰åšç‰©é¤¨"],
                sister_cities: ["ãƒãƒ¼ã‚¹ï¼ˆã‚¤ã‚®ãƒªã‚¹ï¼‰", "ã‚«ãƒ«ãƒ­ãƒ´ã‚£ãƒ»ãƒ´ã‚¡ãƒªï¼ˆãƒã‚§ã‚³ï¼‰", "åˆ¥åºœï¼ˆæ—¥æœ¬ï¼‰"]
            },
            "åŒ—æ¡œå¸‚": {
                population: 156789,
                density: 351.9,
                area: 445.67,
                type: "è¾²æ¥­éƒ½å¸‚",
                industries: ["è¾²æ¥­", "é£Ÿå“åŠ å·¥æ¥­", "ç•œç”£æ¥­"],
                mayor: "è¾²æ¥­ä¸‰éƒ",
                specialties: ["åŒ—æ¡œç±³", "é«˜åŸé‡èœ", "ç‰§å ´ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ "],
                attractions: ["è¾²æ¥­ä½“é¨“æ‘", "ç‰§å ´å…¬åœ’", "åç©«ç¥­ä¼šå ´"],
                sister_cities: ["ã‚¢ã‚¤ã‚ªãƒ¯ï¼ˆã‚¢ãƒ¡ãƒªã‚«ï¼‰", "ãƒˆã‚¹ã‚«ãƒ¼ãƒŠï¼ˆã‚¤ã‚¿ãƒªã‚¢ï¼‰", "ãƒ¯ã‚¤ã‚«ãƒˆï¼ˆãƒ‹ãƒ¥ãƒ¼ã‚¸ãƒ¼ãƒ©ãƒ³ãƒ‰ï¼‰"]
            }
        };
        
        // è‰²ã®å–å¾—é–¢æ•°
        function getColor(density) {
            return density > 1500 ? '#800026' :
                   density > 1000 ? '#BD0026' :
                   density > 800  ? '#E31A1C' :
                   density > 600  ? '#FC4E2A' :
                   density > 400  ? '#FD8D3C' :
                   density > 200  ? '#FEB24C' :
                                    '#FFEDA0';
        }
        
        // ã‚¹ã‚¿ã‚¤ãƒ«é–¢æ•°
        function style(feature) {
            const city = cityData[feature.properties.name];
            return {
                fillColor: getColor(city ? city.density : 0),
                weight: 2,
                opacity: 1,
                color: 'white',
                dashArray: '3',
                fillOpacity: 0.7
            };
        }
        
        // ãƒã‚¤ãƒ©ã‚¤ãƒˆæ©Ÿèƒ½
        function highlightFeature(e) {
            const layer = e.target;
            
            layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
            });
            
            layer.bringToFront();
        }
        
        // ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
        function resetHighlight(e) {
            geojsonLayer.resetStyle(e.target);
        }
        
        // ã‚¯ãƒªãƒƒã‚¯æ™‚ã®è©³ç´°è¡¨ç¤º
        function showCityDetails(cityName) {
            const city = cityData[cityName];
            if (!city) return;
            
            const infoPanel = document.getElementById('info-panel');
            infoPanel.classList.add('active');
            
            const detailsHtml = `
                <div class="city-info">
                    <h2>${cityName}</h2>
                    <div class="info-item">
                        <span class="info-label">ã‚¿ã‚¤ãƒ—</span>
                        <span class="info-value">${city.type}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">äººå£</span>
                        <span class="info-value">${city.population.toLocaleString()}äºº</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">é¢ç©</span>
                        <span class="info-value">${city.area} kmÂ²</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">äººå£å¯†åº¦</span>
                        <span class="info-value">${city.density}äºº/kmÂ²</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">å¸‚é•·</span>
                        <span class="info-value">${city.mayor}</span>
                    </div>
                </div>
                <div class="chart-container">
                    <h3>ä¸»è¦ç”£æ¥­</h3>
                    <ul>
                        ${city.industries.map(ind => `<li>${ind}</li>`).join('')}
                    </ul>
                </div>
                <div class="chart-container">
                    <h3>ç‰¹ç”£å“</h3>
                    <ul>
                        ${city.specialties.map(spec => `<li>${spec}</li>`).join('')}
                    </ul>
                </div>
                <div class="chart-container">
                    <h3>è¦³å…‰ã‚¹ãƒãƒƒãƒˆ</h3>
                    <ul>
                        ${city.attractions.map(attr => `<li>${attr}</li>`).join('')}
                    </ul>
                </div>
                <div class="chart-container">
                    <h3>å§‰å¦¹éƒ½å¸‚</h3>
                    <ul>
                        ${city.sister_cities.map(sc => `<li>${sc}</li>`).join('')}
                    </ul>
                </div>
            `;
            
            document.getElementById('city-details').innerHTML = detailsHtml;
        }
        
        // å„ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ã«å¯¾ã™ã‚‹å‡¦ç†
        function onEachFeature(feature, layer) {
            // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
            if (feature.properties && feature.properties.name) {
                const city = cityData[feature.properties.name];
                if (city) {
                    layer.bindPopup(`
                        <strong>${feature.properties.name}</strong><br>
                        äººå£: ${city.population.toLocaleString()}äºº<br>
                        é¢ç©: ${city.area} kmÂ²
                    `);
                }
            }
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: function(e) {
                    showCityDetails(feature.properties.name);
                }
            });
        }
        
        // GeoJSONãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        let sakuraGeoJSON;
        let geojsonLayer;
        
        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å®Œå…¨ãªGeoJSONã‚’ä½¿ç”¨
        fetch('/sakura-ken/data/sakura-prefecture.geojson')
            .then(response => response.json())
            .then(data => {
                sakuraGeoJSON = data;
                // çœŒå…¨ä½“ã®å¢ƒç•Œã‚’é™¤ã„ã¦å¸‚ã®ã¿ã‚’è¡¨ç¤º
                const citiesOnly = {
                    type: "FeatureCollection",
                    features: data.features.filter(f => f.properties.name !== "æ¡œçœŒ")
                };
                
                geojsonLayer = L.geoJSON(citiesOnly, {
                    style: style,
                    onEachFeature: onEachFeature
                }).addTo(map);
                
                // åœ°å›³ã®ç¯„å›²ã‚’èª¿æ•´
                map.fitBounds(geojsonLayer.getBounds());
                
                // ãƒ©ãƒ™ãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½œæˆ
                createLabelsLayer(citiesOnly);
            })
            .catch(error => {
                console.error('GeoJSONã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
                useInlineGeoJSON();
            });
        
        // å‡¡ä¾‹ã®è¿½åŠ 
        const legend = L.control({position: 'bottomright'});
        
        legend.onAdd = function (map) {
            const div = L.DomUtil.create('div', 'legend');
            const grades = [0, 200, 400, 600, 800, 1000, 1500];
            
            div.innerHTML = '<h4>äººå£å¯†åº¦ï¼ˆäºº/kmÂ²ï¼‰</h4>';
            
            for (let i = 0; i < grades.length; i++) {
                div.innerHTML +=
                    '<div class="legend-item">' +
                    '<div class="legend-color" style="background:' + getColor(grades[i] + 1) + '"></div>' +
                    grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] : '+') +
                    '</div>';
            }
            
            return div;
        };
        
        legend.addTo(map);
        
        // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³GeoJSONãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰
        function useInlineGeoJSON() {
            const inlineGeoJSON = {
                "type": "FeatureCollection",
                "features": [
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "æ¡œèŠ±å¸‚",
                            "type": "çœŒåºæ‰€åœ¨åœ°",
                            "area_km2": 456.78,
                            "population": 890234,
                            "density_per_km2": 1948.3
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[
                                [139.4234, 35.5234],
                                [139.5234, 35.5123],
                                [139.6123, 35.4890],
                                [139.6234, 35.4234],
                                [139.6123, 35.3567],
                                [139.5890, 35.3456],
                                [139.5234, 35.3567],
                                [139.4567, 35.3789],
                                [139.4234, 35.4123],
                                [139.4123, 35.4567],
                                [139.4234, 35.5234]
                            ]]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "æ¡œå·å¸‚",
                            "type": "æ¸¯æ¹¾éƒ½å¸‚",
                            "area_km2": 389.45,
                            "population": 523456,
                            "density_per_km2": 1344.2
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[
                                [139.6234, 35.4234],
                                [139.7234, 35.4123],
                                [139.8123, 35.3890],
                                [139.8234, 35.3234],
                                [139.8123, 35.2567],
                                [139.7890, 35.2456],
                                [139.7234, 35.2567],
                                [139.6567, 35.2789],
                                [139.6234, 35.3123],
                                [139.6123, 35.3567],
                                [139.6234, 35.4234]
                            ]]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "æ±æ¡œå¸‚",
                            "type": "ãƒã‚¤ãƒ†ã‚¯å·¥æ¥­éƒ½å¸‚",
                            "area_km2": 312.67,
                            "population": 412345,
                            "density_per_km2": 1319.2
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[
                                [139.7234, 35.6234],
                                [139.8234, 35.6123],
                                [139.8890, 35.5890],
                                [139.8901, 35.5234],
                                [139.8567, 35.4567],
                                [139.8234, 35.4456],
                                [139.7567, 35.4567],
                                [139.7234, 35.4890],
                                [139.7123, 35.5234],
                                [139.7234, 35.5890],
                                [139.7234, 35.6234]
                            ]]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "è¥¿æ¡œå¸‚",
                            "type": "æ­´å²æ–‡åŒ–éƒ½å¸‚",
                            "area_km2": 234.56,
                            "population": 198765,
                            "density_per_km2": 847.8
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[
                                [139.2567, 35.4234],
                                [139.3567, 35.4123],
                                [139.4234, 35.3890],
                                [139.4345, 35.3234],
                                [139.4234, 35.2567],
                                [139.3890, 35.2456],
                                [139.3234, 35.2567],
                                [139.2567, 35.2789],
                                [139.2345, 35.3123],
                                [139.2456, 35.3567],
                                [139.2567, 35.4234]
                            ]]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "å—æ¡œå¸‚",
                            "type": "æ¸©æ³‰è¦³å…‰éƒ½å¸‚",
                            "area_km2": 567.89,
                            "population": 287654,
                            "density_per_km2": 506.5
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[
                                [139.4567, 35.3234],
                                [139.5567, 35.3123],
                                [139.6234, 35.2890],
                                [139.6345, 35.2234],
                                [139.5890, 35.1567],
                                [139.5234, 35.1456],
                                [139.4567, 35.1567],
                                [139.3890, 35.1789],
                                [139.3567, 35.2123],
                                [139.3678, 35.2567],
                                [139.4567, 35.3234]
                            ]]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "åŒ—æ¡œå¸‚",
                            "type": "è¾²æ¥­éƒ½å¸‚",
                            "area_km2": 445.67,
                            "population": 156789,
                            "density_per_km2": 351.9
                        },
                        "geometry": {
                            "type": "Polygon",
                            "coordinates": [[
                                [139.3567, 35.7234],
                                [139.4567, 35.7123],
                                [139.5234, 35.6890],
                                [139.5345, 35.6234],
                                [139.5234, 35.5567],
                                [139.4890, 35.5456],
                                [139.4234, 35.5567],
                                [139.3567, 35.5789],
                                [139.3234, 35.6123],
                                [139.3345, 35.6567],
                                [139.3567, 35.7234]
                            ]]
                        }
                    }
                ]
            };
            
            geojsonLayer = L.geoJSON(inlineGeoJSON, {
                style: style,
                onEachFeature: onEachFeature
            }).addTo(map);
            
            map.fitBounds(geojsonLayer.getBounds());
            createLabelsLayer(inlineGeoJSON);
        }
        
        // ãƒ©ãƒ™ãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä½œæˆ
        function createLabelsLayer(geoJSON) {
            const labels = [];
            geoJSON.features.forEach(feature => {
                const center = getCentroid(feature.geometry.coordinates[0]);
                const label = L.marker(center, {
                    icon: L.divIcon({
                        className: 'city-label',
                        html: `<div style="font-weight: bold; font-size: 12px; text-shadow: 1px 1px 2px white, -1px -1px 2px white, 1px -1px 2px white, -1px 1px 2px white;">${feature.properties.name}</div>`,
                        iconSize: [100, 20]
                    })
                });
                labels.push(label);
            });
            labelsLayer = L.layerGroup(labels).addTo(map);
        }
        
        // ãƒãƒªã‚´ãƒ³ã®ä¸­å¿ƒç‚¹ã‚’è¨ˆç®—
        function getCentroid(coords) {
            let lat = 0, lng = 0;
            coords.forEach(coord => {
                lng += coord[0];
                lat += coord[1];
            });
            return [lat / coords.length, lng / coords.length];
        }
        
        // æ¤œç´¢æ©Ÿèƒ½
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');
        
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            searchResults.innerHTML = '';
            
            if (searchTerm.length === 0) {
                searchResults.style.display = 'none';
                return;
            }
            
            const matches = [];
            for (const cityName in cityData) {
                if (cityName.toLowerCase().includes(searchTerm)) {
                    matches.push(cityName);
                }
            }
            
            if (matches.length > 0) {
                searchResults.style.display = 'block';
                matches.forEach(cityName => {
                    const item = document.createElement('div');
                    item.className = 'search-result-item';
                    item.textContent = cityName;
                    item.onclick = () => zoomToCity(cityName);
                    searchResults.appendChild(item);
                });
            } else {
                searchResults.style.display = 'none';
            }
        });
        
        // å¸‚ã«ã‚ºãƒ¼ãƒ 
        function zoomToCity(cityName) {
            geojsonLayer.eachLayer(layer => {
                if (layer.feature.properties.name === cityName) {
                    map.fitBounds(layer.getBounds());
                    layer.fire('click');
                    searchResults.style.display = 'none';
                    searchInput.value = '';
                }
            });
        }
        
        // æƒ…å ±ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
        function closeInfoPanel() {
            document.getElementById('info-panel').classList.remove('active');
        }
        
        // ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—ã®å¤‰æ›´
        document.getElementById('data-type').addEventListener('change', function(e) {
            currentDataType = e.target.value;
            updateDataVisualization();
        });
        
        // ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ã®æ›´æ–°
        function updateDataVisualization() {
            if (geojsonLayer) {
                geojsonLayer.eachLayer(layer => {
                    layer.setStyle(style(layer.feature));
                    
                    // ãƒ‡ãƒ¼ã‚¿ãƒ©ãƒ™ãƒ«ã®æ›´æ–°
                    if (currentDataType !== 'none') {
                        const data = getDataValue(layer.feature.properties.name, currentDataType);
                        if (data) {
                            layer.bindTooltip(data, {
                                permanent: true,
                                direction: 'center',
                                className: 'data-label'
                            }).openTooltip();
                        }
                    } else {
                        layer.unbindTooltip();
                    }
                });
            }
        }
        
        // ãƒ‡ãƒ¼ã‚¿å€¤ã®å–å¾—
        function getDataValue(cityName, dataType) {
            const city = cityData[cityName];
            if (!city) return null;
            
            switch(dataType) {
                case 'population':
                    return city.population.toLocaleString() + 'äºº';
                case 'density':
                    return city.density + 'äºº/kmÂ²';
                case 'area':
                    return city.area + 'kmÂ²';
                case 'gdp':
                    // ä»®ã®GDPãƒ‡ãƒ¼ã‚¿
                    const gdpData = {
                        "æ¡œèŠ±å¸‚": "3.2å…†å††",
                        "æ¡œå·å¸‚": "2.1å…†å††",
                        "æ±æ¡œå¸‚": "2.8å…†å††",
                        "è¥¿æ¡œå¸‚": "0.8å…†å††",
                        "å—æ¡œå¸‚": "1.5å…†å††",
                        "åŒ—æ¡œå¸‚": "1.4å…†å††"
                    };
                    return gdpData[cityName] || 'N/A';
                default:
                    return null;
            }
        }
        
        // ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
        document.getElementById('cities-layer').addEventListener('change', function(e) {
            if (e.target.checked) {
                geojsonLayer.addTo(map);
            } else {
                map.removeLayer(geojsonLayer);
            }
        });
        
        document.getElementById('labels-layer').addEventListener('change', function(e) {
            if (e.target.checked && labelsLayer) {
                labelsLayer.addTo(map);
            } else if (labelsLayer) {
                map.removeLayer(labelsLayer);
            }
        });
        
        document.getElementById('population-layer').addEventListener('change', function(e) {
            if (e.target.checked) {
                legend.addTo(map);
            } else {
                legend.remove();
            }
        });
        
        // è¦³å…‰ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼‰
        document.getElementById('tourism-layer').addEventListener('change', function(e) {
            if (e.target.checked) {
                // è¦³å…‰ã‚¹ãƒãƒƒãƒˆã®è¿½åŠ ï¼ˆä¾‹ï¼‰
                if (!tourismLayer) {
                    const tourismSpots = [
                        {name: "æ¡œèŠ±åŸ", lat: 35.45, lng: 139.5, type: "åŸéƒ­"},
                        {name: "æ¡œå·æ¸©æ³‰", lat: 35.3, lng: 139.28, type: "æ¸©æ³‰"},
                        {name: "æ±æ¡œãƒ†ã‚¯ãƒãƒ‘ãƒ¼ã‚¯", lat: 35.55, lng: 139.8, type: "ç”£æ¥­è¦³å…‰"}
                    ];
                    
                    const markers = tourismSpots.map(spot => {
                        return L.marker([spot.lat, spot.lng])
                            .bindPopup(`<strong>${spot.name}</strong><br>ã‚¿ã‚¤ãƒ—: ${spot.type}`);
                    });
                    
                    tourismLayer = L.layerGroup(markers);
                }
                tourismLayer.addTo(map);
            } else if (tourismLayer) {
                map.removeLayer(tourismLayer);
            }
        });
        
        // äº¤é€šã‚¤ãƒ³ãƒ•ãƒ©ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼‰
        document.getElementById('transport-layer').addEventListener('change', function(e) {
            if (e.target.checked) {
                // ä¸»è¦é“è·¯ã®è¿½åŠ ï¼ˆä¾‹ï¼‰
                if (!transportLayer) {
                    const roads = [
                        [[35.5, 139.3], [35.4, 139.7]],
                        [[35.6, 139.5], [35.2, 139.6]]
                    ];
                    
                    const lines = roads.map(road => {
                        return L.polyline(road, {
                            color: 'red',
                            weight: 3,
                            opacity: 0.7
                        }).bindPopup('ä¸»è¦é“è·¯');
                    });
                    
                    transportLayer = L.layerGroup(lines);
                }
                transportLayer.addTo(map);
            } else if (transportLayer) {
                map.removeLayer(transportLayer);
            }
        });
    </script>
</body>
</html>